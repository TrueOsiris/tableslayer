services:
  db:
    image: ghcr.io/tursodatabase/libsql-server:latest
    platform: linux/amd64
    environment:
      - SQLD_NODE=primary
    volumes:
      - libsql-data:/var/lib/libsql

  web:
    build:
      context: .
      dockerfile: Dockerfile
    depends_on:
      - db
    environment:
      # libSQL / Turso connection
      TURSO_APP_DB_URL: "libsql://db:8080?tls=0"
      TURSO_APP_DB_AUTH_TOKEN: "devtoken" 

      # App-specific env (fill these with your real values or use an .env file)
      ENV_NAME: "development"
      BASE_URL: "http://localhost:3000"
      BODY_SIZE_LIMIT: "20M"

      # Uncomment/fill as needed:
      # GITHUB_PR_NUMBER: ""
      # TURSO_API_TOKEN: ""
      # RESEND_TOKEN: ""
      # RESEND_AUDIENCE_ID: ""
      # DEV_EMAIL: ""
      # CLOUDFLARE_ACCOUNT_ID: ""
      # CLOUDFLARE_R2_ACCESS_KEY: ""
      # CLOUDFLARE_R2_SECRET_KEY: ""
      # CLOUDFLARE_R2_BUCKET_NAME: ""
      # SENTRY_DSN: ""
      # SENTRY_AUTH_TOKEN: ""
      # STRIPE_SECRET_KEY: ""
      # STRIPE_WEBHOOK_KEY: ""
      # STRIPE_LIFETIME_ID: ""
      # STRIPE_YEARLY_ID: ""
      # STRIPE_PRICE_ID_MONTHLY: ""
      # STRIPE_PRICE_ID_YEARLY: ""
      # STRIPE_PRICE_ID_LIFETIME: ""
      # STRIPE_API_KEY: ""

    ports:
      - "3000:3000"
    # If you want live reload in dev, you can mount source; for now we keep it simple
    # volumes:
    #   - .:/app

volumes:
  libsql-data:

